# ClipStream API

ClipStream — это прототип небольшой социальной сети для обмена короткими видеоклипами. Сервис предоставляет REST API, позволяющее регистрироваться, авторизовываться, выкладывать видео, указывать музыкальные жанры, комментировать и лайкать ролики, подписываться на другие профили и получать рекомендации на основе любимых жанров.

## Возможности

- Регистрация пользователей и выдача JWT токенов авторизации.
- Загрузка видеороликов с сохранением файлов в директорию `uploads/`.
- Привязка музыкальных жанров к ролику при загрузке (существующие жанры переиспользуются, новые создаются автоматически).
- Получение списка опубликованных видео и отдельных карточек роликов.
- Добавление и просмотр комментариев.
- Лайки с возможностью повторного нажатия (повторный запрос снимает лайк).
- Подписки на другие аккаунты с возможностью отписки.
- Рекомендации по подпискам: сервис предлагает ролики по жанрам, которые пользователь чаще всего лайкал.

## Быстрый старт

1. **Создайте виртуальное окружение и установите зависимости**:

   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```

2. **Запустите сервер разработки**:

   ```bash
   uvicorn app.main:app --reload
   ```

   Приложение будет доступно по адресу <http://127.0.0.1:8000>. Файлы загружаемых роликов сохраняются в каталоге `uploads/` (создаётся автоматически).

3. **Документация API**:

   - Swagger UI: <http://127.0.0.1:8000/docs>
   - ReDoc: <http://127.0.0.1:8000/redoc>

## Основные эндпоинты

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| `POST` | `/auth/register` | Регистрация нового пользователя. |
| `POST` | `/auth/login` | Получение JWT токена (используйте `username` и `password` формы). |
| `GET` | `/users/me` | Профиль текущего пользователя. |
| `POST` | `/videos` | Загрузка видео (`multipart/form-data`: `title`, `description`, `genres`, `file`). |
| `GET` | `/videos` | Список роликов (пагинация через `skip` и `limit`). |
| `GET` | `/videos/{id}` | Детали конкретного ролика. |
| `POST` | `/videos/{id}/comments` | Добавление комментария. |
| `POST` | `/videos/{id}/like` | Поставить или убрать лайк. |
| `POST` | `/users/{id}/subscribe` | Подписаться или отписаться от пользователя. |
| `GET` | `/users/me/recommendations` | Рекомендованные ролики по любимым жанрам. |

## Структура проекта

```
app/
├── __init__.py
├── database.py        # Настройка SQLAlchemy и вспомогательные функции.
├── main.py            # Точки входа FastAPI и реализация эндпоинтов.
├── models.py          # SQLAlchemy-модели и таблицы связей.
├── schemas.py         # Pydantic-схемы для сериализации/валидации.
└── security.py        # Хеширование паролей и работа с JWT.
uploads/               # Каталог для сохранения загруженных видео.
```

## Примечания по безопасности

- Секретный ключ JWT (`SECRET_KEY` в `app/security.py`) задан константой и должен быть заменён на защищённое значение при деплое.
- SQLite используется для простоты. Для продакшена стоит заменить на полноценную СУБД и настроить миграции.
- Каталог `uploads/` хранит исходные файлы и требует соответствующей защиты при эксплуатации.
